<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8" />
    <title>William Lachance's Log (page 17)</title>
    <meta name="description" content="William Lachance's Log (page 17)" />
    <meta name="author" content="William Lachance" />
    <meta name="keywords" content="Orangutan, Meditation, Iodide, Web, GoFaster, Release Engineering, zen, Python, Glean, Time, Metrics Graphics, iphone, Buddhism, Video, Transit to Go, Responsiveness, Data, Profiling, Docker, Social Media, GNOME, Psychology, Personal, Food, Montreal, Taskcluster, Talos, Telemetry, Treeherder, Mozilla, telemetry, Open Data, ateam, Data Visualization, mozregression, all, MSF, Pandaboard, Polling, Philosophy, Recurse, Usability, Meta, Irydium, Counting, email, Infraherder, Statistics, Free Software, Bikes, Mission Control, Nixi, Music, Business, Transit, BIXI, iodide, AI, Life, ÃŽle Sans Fil, Eideticker, Android, Voltus, Performance, FirefoxOS, hbus, Documentation, Environment, meta, Toronto, Ebola, Cats, Perfherder, Coffee, WifiDog, Sphinx, SQL, Community" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="canonical" href="https://wrla.ch/index-17.html" />

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/pygments.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/scribble.css"
    />
    <!-- Feeds -->
    <link
      rel="alternate"
      type="application/atom+xml"
      href="/feeds/all.atom.xml"
      title="Atom Feed"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      href="/feeds/all.rss.xml"
      title="RSS Feed"
    />
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <nav
      class="flex items-center justify-between flex-wrap bg-gray-800 py-1 px-8"
    >
      <div class="flex items-center flex-shrink-0 text-gray-400 mr-6">
        <div class="p-1">
          <a href="/index.html"
            ><img
              src="/img/wlach_icon.png"
              width="32"
              height="32"
              class="p rounded"
          /></a>
        </div>
        <div class="p-1">
          <a
            href="/index.html"
            class="text-gray-200 font-semibold text-xl tracking-tight hover:text-white"
            >wlach log</a
          >
        </div>
      </div>
      <div class="flex-grow lg:flex lg:items-center">
        <div class="text-sm lg:flex-grow">
          <a
            href="/About.html"
            class="mt-4 lg:inline-block lg:mt-0 hover:text-white mr-4 text-gray-600"
          >
            About</a>
          <a
            class="mt-4 lg:inline-block lg:mt-0 text-gray-600 hover:text-white mr-4"
            href="/feeds/all.atom.xml"
            >Atom</a
          >
          <a
            class="mt-4 lg:inline-block lg:mt-0 text-gray-600 hover:text-white mr-4"
            href="/feeds/all.rss.xml"
            >RSS</a
          >
        </div>
      </div>
    </nav>
    <div id="content" class="container max-w-screen-md px-8 py-4 mx-auto">
         <article>
  <header>
    <h2><a href="/blog/2009/04/creating-a-google-transit-feed-for-fun-and-profit/">Creating a google transit feed for fun and profit</a></h2>
    <p class="index-date">Apr 23rd, 2009</p>
    <p><span class="tags"><a href="/tags/hbus.html">hbus</a></span></p>
  </header>

<p>People frequently ask me how I manage to collect and input the data that is used by hbus.ca, given Metro Transit&rsquo;s intransigence. The &ldquo;bike and GPS&rdquo; angle is well known <a href="http://www.thecoast.ca/halifax/beta-the-public-transit-day-tripper/Content?oid=1098826">by now</a>, but what about the rest of the process? How do I get the data into a format that hbus.ca can consume?</p>

<p>The defacto standard for the interchange of transit information is <a href="http://code.google.com/p/googletransitdatafeed">Google Transit Feed</a> (GTFS). This exceedingly simple comma seperated value format is now supported by a plethora of software, including <a href="http://google.com/transit">Google Transit</a>, <a href="http://github.com/bmander/graphserver">graphserver</a>, as well as my very own <a href="http://github.com/wlach/libroutez">libroutez</a> (used by hbus.ca). It was obvious to me right from the beginning that the first step to building hbus.ca would be to create one of these feeds.</p>

<p>Manipulating a GTFS by hand is probably not a great idea. It&rsquo;s basically a dump of a relational database, and is pretty inscrutable from the point of view of a human being. What I really want to be able to do is be able
 <br />to manipulate things on the level of stops, service periods, and routes: and let some kind of abstraction layer take care of the low-level details. Fortunately, the awesome engineers at google created a python library called <a href="http://code.google.com/p/googletransitdatafeed">Google Transit Data Feed</a>, which can help with creating one of these things by providing abstractions of the key elements of a google transit feed (stops, service periods, etc.). You can then write a program which uses these abstractions to create and save a GTFS.</p>

<p>Of course, providing the library appropriate information is easier said than done. Metro Transit&rsquo;s PDF schedules are not readily computer parsable (being designed to be printed out, after all). I needed some kind of semi-automated way of converting a Metro Transit schedule into GTFS, or this whole project was
 <br />going nowhere fast.</p>

<p>As an initial step, it turns out that it&rsquo;s quite possible to extract textual information from a PDF using the open source <a href="http://poppler.freedesktop.org/">popplar</a> library. From there, it&rsquo;s possible to extract the stopping times for an individual bus route. Let&rsquo;s give an example. For example, let&rsquo;s take the case of adding the 60 (Portland Hill&rsquo;s route), something I&rsquo;m currently working on. All I had to do was download the PDF file from Metro Transit&rsquo;s site and then run the following on the command line:
 <br /><code>&lt;br /&gt; pdftotext -raw route60.pdf&lt;br /&gt;</code>
 <br />The raw option basically makes sure the raw strings are dumped to disk, and that no attempt is made to preserve formatting. The result is a text file with content like this in it:
 <br /><code>&lt;br /&gt; 842a 847a 855a 858a 903a 906a 912a -&lt;br /&gt; 857a 902a 910a 913a 918a 921a - 925a&lt;br /&gt; 910a 915a 923a 926a 931a 934a 940a -&lt;br /&gt; 940a 945a 953a - 1000a 1003a 1009a -&lt;br /&gt; ...and every 30 minutes until&lt;br /&gt; 210p 215p 223p - 230p 233p 239p -&lt;br /&gt;</code>
 <br />This type of format can be parsed easily enough. To create a proper transit feed though, schedule information isn&rsquo;t enough: you also need to know the locations of the stops, names of routes, etc. After some deliberation, I came to the determination that I needed some kind of intermediate format to store the above schedule information and this additional information. It would be readable both by humans (to ease its creation) and machines.</p>

<p>The obvious markup for something like this is <a href="http://yaml.org">YAML</a> (if you&rsquo;re still using XML to store structured information, run, don&rsquo;t walk, and look at YAML: you can thank me later). Simple, clean, effective. GTFS is still the better choice for using the information in another application as its representation is much more amenable to being stored in a graph. Here&rsquo;s a few examples of my YAML format in action:</p>

<p><a href="http://github.com/wlach/halifax-transit-feed/blob/fef68c18928272670b3c57ae5530260deed85883/7-robie-to-gottingen.yml">7 (Robie to Gottingen)</a>
 <br /><a href="http://github.com/wlach/halifax-transit-feed/blob/fef68c18928272670b3c57ae5530260deed85883/10-to-westphal.yml">10 (Westphal)</a></p>

<p>Besides the scheduling information, the other main interesting component of a GTFS is the location of the stops. As anyone who&rsquo;s used a Metro Transit schedule has noticed, only major timepoints are covered in the PDF schedules. What of all the stops in between? This is where the bike and GPS come in.</p>

<p>What I did was take a standard GPS from Mountain Equipment Co-op (The Garmin GPSMap 60x), get on my bike, take the readings of individual gotime numbers and positioning information, of the individual stops between the major timepoints. I then took this device back to my computer and, using a utility called <a href="http://gpsbabel.org">GPSBabel</a>, dumped out the stop information in a format called &ldquo;comma seperated value&rdquo;. It looks like this:
 <br /><code>&lt;br /&gt; 44.65825, -63.59252, 6785-21-31-33-34-35-3-7&lt;br /&gt; 44.65982, -63.59452, 6768-21-31-33-35-86-3-7&lt;br /&gt; 44.66113, -63.59659, 6782-21-31-33-34-35-3-7&lt;br /&gt;</code>
 <br />The first two items are latitude and longitude, providing the positioning of the stop. The last item is a gotime number, followed by the set of buses which pass by the stop. Turning this into YAML is a matter of applying
 <br />the following regular expression to the input:
 <br /><code>&lt;br /&gt; \([0-9]+.[0-9]+\), \(-63.[0-9]+\), \([0-9]+\)- -&gt; - { name: xxx, stop_code: \3, lat: \1, lng: \2 }&lt;br /&gt;</code>
 <br />To get an actual name for the stop (i.e.: &ldquo;Gottingen and Young&rdquo;), I wrote a simple script which finds the nearest intersection close to the stop in the <a href="http://geobase.ca">GeoBase</a> dataset. I then (at my discretion) corrected it based on my on-the-street knowledge of the layout of Halifax as well as adding certain details to help the user (e.g. bus stops on the way to the south end of Halifax are marked &ldquo;south bound&rdquo;).</p>

<p>With these two elements in place (a format for creating human-readable transit information and a library for creating GTFS), the only thing left to do is create a program which bridges the gap. Behold, the magic of
 <br /><a href="http://github.com/wlach/halifax-transit-feed/blob/fef68c18928272670b3c57ae5530260deed85883/createfeed.py">createfeed.py</a>. With all of this in place, creating a google transit feed for Halifax is a simple matter of typing &ldquo;make&rdquo;.</p>

<p>Is this a ridiculous amount of work? I wouldn&rsquo;t say so. The vast, vast majority of my work on hbus.ca has been in creating the pathfinding code and geocoding functionality. This is work that can be translated to many different municipalities, and can easily be extended and made more useful in a myriad of ways.</p>

<p>What does seem a little intimidating to me is completing what I started. Capturing bus stop information for the Halifax peninsula is one thing, but covering the outlying areas (Bayer&rsquo;s Lake, Sackville, etc.) is quite
 <br />another. There&rsquo;s a lot of biking involved there, more perhaps than what one person can reasonably be expected to do. It was my hope that the initial release of hbus would validate the model of community-developed transit software to Metro Transit and they would see the benefit of releasing their internal copy of this data to the public, but unfortunately that doesn&rsquo;t seem to have happened.</p>

<p>Getting that problem solved seems to be more a political problem than a technical one, and it&rsquo;s not my specialty. It really does make me wonder if I shouldn&rsquo;t reconsider the option of crowd sourcing, which I had
 <br /><a href="http://wrla.ch/blog/2009/03/hbusca-and-thoughts-about-crowdsourcing/">rejected</a> earlier.</p> 
  <hr/>
</article>
<article>
  <header>
    <h2><a href="/blog/2009/03/hbus-ca-and-thoughts-about-crowdsourcing/">hbus.ca and thoughts about crowdsourcing</a></h2>
    <p class="index-date">Mar 25th, 2009</p>
    <p><span class="tags"><a href="/tags/hbus.html">hbus</a></span></p>
  </header>

<figure id="attachment_18" style="width: 410px" class="wp-caption alignleft"><img src="/files/2009/03/hbus_mini.png" alt="hbus in action" title="hbus_mini" width="410" height="409" class="size-full wp-image-18" />
 <figcaption class="wp-caption-text">hbus in action</figcaption></figure>

<p>So I opened up my baby, <a href="http://hbus.ca" title="hbus.ca">hbus.ca</a>, to the public last week (though traffic only really started to pick up yesterday, after a <a href="http://www.metronews.ca/halifax/local/article/201622">positive article</a> in the daily news). This site, a trip planner for the Halifax Regional Municipality, was the cumulation of about 6 months of part time work on my part, between contracts for my awesome company, <a href="http://navarra.ca">Navarra</a>.</p>

<p>I&rsquo;m debating on whether or not to start a seperate blog for hbus. At the moment I&rsquo;m leaning towards no: my thinking is that most people don&rsquo;t care about the inner workings of a site like hbus. They just want to figure out how to get from point A to B. Those who do care can read the rest of what I (and my part time co-conspirator, <a href="http://cpirate.livejournal.com">Peter McCurdy</a>) have to say.</p>

<p>The most glaring limitation in hbus right now is that its route coverage is woefully limited. Trips on the main Halifax peninsula are generally planned pretty effectively. If you&rsquo;re travelling to a suburban area like Bayer&rsquo;s Lake or Burnside, not so much (unless you&rsquo;re lucky enough to be starting/ending near a bus timepoint). What is to be done?</p>

<p>A frequent suggestion I get from more technically minded folks is that I should &ldquo;crowd source&rdquo; the missing information. This basically implies creating a wikipedia-like architecture such that people could contribute their favourite stops, routes, etc.</p>

<p>It&rsquo;s a tempting idea. Such sites as <a href="http://openstreetmap.org">OpenStreetMap</a> show that this approach can be very effective for gathering large amount of geographical data. I&rsquo;m frankly not convinced it&rsquo;s the right approach here though. The fact is that <a href="http://halifax.ca/metrotransit">Metro Transit</a> MUST have a complete set of stops, route schedules, and route plans internally. There&rsquo;s no way they could plan their operations halfway effectively otherwise. Why should I burden the public with the task of recreating something which has already been done?</p>

<p>I may be crazy, but I think the best avenue for the moment is to try to convince Metro Transit that it would be worthwhile to make this information public. I paid for the generation of the information with my tax dollars, why shouldn&rsquo;t I be able to make use of it? The preferred format for this information is <a href="http://code.google.com/p/googletransitdatafeed/">Google Transit Data Feed</a>, but I could make use of information in just about any representation (Arc GIS, etc.). Just give me what you have, and I&rsquo;ll take of the rest. <a href="http://code.google.com/p/googletransitdatafeed/wiki/PublicFeeds">Over 20</a> of the most successful transit agencies in North America (many of them much bigger than Metro Transit) have opened up their information to the public, with only positive results.</p>

<p>The most obvious use of this information is a trip planner and, yes, I know every agency and their dog has (or will have) one of these. But maybe someone has a cool idea on how to make a trip planner easier to use (compare <a href="http://hbus.ca">hbus.ca</a> with <a href="www.stm.info/azimuts/index.htm">Tous Azimuts</a>). Or what about <a href="http://www.walkscore.com/transit-map.php">transit maps</a> that help people figure out where to live? Or iPhone and Blackberry applications? Or cool <a href="http://myttc.ca/screensaver">screensavers</a>? Or or or. The possibilities are truly endless once the data is out there. Come on Metro Transit, you have nothing to lose and the eternal love of your ridership to gain.</p> 
  <hr/>
</article>
<article>
  <header>
    <h2><a href="/blog/2009/03/breaking-news-cat-watches-himself-in-tv/">Breaking news: Cat watches himself in TV</a></h2>
    <p class="index-date">Mar 6th, 2009</p>
    <p><span class="tags"><a href="/tags/Meta.html">Meta</a></span></p>
  </header>

<p> <a title="photo sharing" href="http://www.flickr.com/photos/wlach/3325846322/"><img style="border: solid 2px #000000;" src="http://farm4.static.flickr.com/3577/3325846322_40e085d6d4_m.jpg" alt="" /></a>   
 <p>
  <br /><a href="http://www.flickr.com/photos/wlach/3325846322/">Cat watching himself</a></p>  
 <p>Originally uploaded by<a href="http://www.flickr.com/people/wlach/">William Lachance</a>
  <br /></p></p>

<p>Been meaning to update this more, but I&rsquo;ve been rather busy. Quite a bit of excitement going on, though I haven&rsquo;t been making time to blog about it (I&rsquo;ve been more into the <a href="http://twitter.com/wlach">twitter</a> thing lately).</p>

<p>More soon.</p> 
  <hr/>
</article>
<article>
  <header>
    <h2><a href="/blog/2009/02/maps-urls-on-mobile-safari/">Maps URLs on mobile Safari</a></h2>
    <p class="index-date">Feb 2nd, 2009</p>
    <p><span class="tags"></span></p>
  </header>

<p>I&rsquo;ve been experimenting a little bit with maps urls on the iphone. If you&rsquo;ve read Apple&rsquo;s web developer guidelines, you&rsquo;ll know that URLs of this form will automatically redirect to the maps application:</p>

<p><a href="http://maps.google.com/maps?geocode=&amp;#038;q=Halifax,Nova">Halifax, Nova Scotia</a>
 <br /><a href="http://maps.google.com/maps?geocode=&amp;#038;q=Halifax,Nova Scotia">Halifax, Nova Scotia</a></p>

<p>This is fine if you just want to highlight one particular location (with no custom metadata), but what if you want to do something more interesting, like display a KML file? You can load these easily from the maps application, so why can&rsquo;t you link to them from a web browser? The URL guidelines explicitly say that the KML part of a query string will be discarded, and indeed it is. What is a web developer to do? Resort to undocumented behaviour, of course! At least in version 2.2 of the iphone software, URLs which request a &ldquo;maps&rdquo; resource with the appropriate parameters will automatically load the appropriate KML file in the maps application:</p>

<p>[Map link][2]
 <br /><a href="maps://?geocode=&amp;#038;q=http://code.google.com/apis/kml/documentation/KML_Samples.kml">Map link</a></p>

<p>Scotia [2]: maps://?geocode=&#38;q=http://code.google.com/apis/kml/documentation/KML_Samples.kml</p> 
  <hr/>
</article>
<footer>
 <ul class="pagination">
  <li class="page-item"><a class="page-link" href="/index-16.html">
    <quote>&larr;</quote></a></li>
  <li class="page-item"><a class="page-link" href="/index.html">1</a></li>
  <li class="page-item"><a class="page-link" href="/index-2.html">2</a></li>
  <li class="page-item"><a class="page-link" href="/index-3.html">3</a></li>
  <li class="page-item"><a class="page-link" href="/index-4.html">4</a></li>
  <li class="page-item"><a class="page-link" href="/index-5.html">5</a></li>
  <li class="page-item"><a class="page-link" href="/index-6.html">6</a></li>
  <li class="page-item"><a class="page-link" href="/index-7.html">7</a></li>
  <li class="page-item"><a class="page-link" href="/index-8.html">8</a></li>
  <li class="page-item"><a class="page-link" href="/index-9.html">9</a></li>
  <li class="page-item"><a class="page-link" href="/index-10.html">10</a></li>
  <li class="page-item"><a class="page-link" href="/index-11.html">11</a></li>
  <li class="page-item"><a class="page-link" href="/index-12.html">12</a></li>
  <li class="page-item"><a class="page-link" href="/index-13.html">13</a></li>
  <li class="page-item"><a class="page-link" href="/index-14.html">14</a></li>
  <li class="page-item"><a class="page-link" href="/index-15.html">15</a></li>
  <li class="page-item"><a class="page-link" href="/index-16.html">16</a></li>
  <li class="page-item active"><a class="page-link" href="/index-17.html">17</a></li>
  <li class="page-item disabled"><a class="page-link" href="#">
    <quote>&rarr;</quote></a></li></ul></footer>
    </div>
    <footer class="container max-w-screen-md px-8 py-4 mx-auto less-important">
      <p>Comments / thoughts? Feel free to send an email to wlach on protonmail.com,
        or toot <a rel="me" href="https://mastodon.social/@wlach">@wlach@mastodon.social</a>.
      </p>
      <p>
        Site generated by
        <a href="https://github.com/greghendershott/frog">Frog</a>.
        Post content is licensed under a
        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
          >Creative Commons Attribution 4.0 Unported License</a
        >.
      </p>
    </footer>
  </body>
</html>